# Reusable Patterns

- Use `Bun.file(path).exists()` for existence checks (async)
- Use `Bun.$` shell for filesystem operations in tests
- Walk up directory tree using `dirname()` until `parent === dir` (root)
- Use `crypto.getRandomValues(new Uint8Array(n))` for crypto-secure random bytes
- Use type guards with `unknown` for runtime validation (return `x is Type` pattern)
- Use `as const` for compile-time tuple inference on required field arrays

---

## 2026-01-07 - e4f5a6

- Implemented validation logic in `src/validate.ts`
- Files changed: `src/validate.ts`, `src/validate.test.ts`, `prd.json`
- **Learnings:**
  - Validation functions should throw descriptive errors, not return booleans
  - Type guard pattern (`function f(x: unknown): x is Type`) provides runtime validation with type narrowing
  - Separate field validation from referential integrity checks for cleaner testing

---

## 2026-01-07 - d1e2f3

- Implemented ID generation utility in `src/id.ts`
- Files changed: `src/id.ts`, `src/id.test.ts`
- **Learnings:**
  - `crypto.getRandomValues()` is globally available in Bun (no import needed)
  - Use Set for O(1) collision checking when generating unique IDs

---

## 2026-01-07 - a7b8c9

- Implemented core JSON read/write utilities in `src/store.ts`
- Files changed: `src/store.ts`, `src/store.test.ts`, `AGENTS.md`, `.gitignore`
- **Learnings:**
  - `Bun.file().size` returns 0 for non-existent files (doesn't throw), use `.exists()` instead
  - `Bun.file().exists()` is async, requires refactoring sync functions
  - `Bun.$` shell template provides clean syntax for filesystem ops in tests

---
